<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- =================== -->
    <!-- Medical History Views -->
    <!-- =================== -->

    <record id="view_medical_history_list" model="ir.ui.view">
        <field name="name">hr.employee.medical.history.list</field>
        <field name="model">hr.employee.medical.history</field>
        <field name="arch" type="xml">
            <list string="Medical History">
                <field name="employee_id"/>
                <field name="diagnosis_date"/>
                <field name="condition"/>
                <field name="condition_type"/>
                <field name="severity"/>
                <field name="is_ongoing"/>
                <field name="follow_up_date"/>
            </list>
        </field>
    </record>

    <record id="view_medical_history_form" model="ir.ui.view">
        <field name="name">hr.employee.medical.history.form</field>
        <field name="model">hr.employee.medical.history</field>
        <field name="arch" type="xml">
            <form string="Medical History">
                <sheet>
                    <group>
                        <field name="employee_id"/>
                        <field name="diagnosis_date"/>
                        <field name="condition"/>
                        <field name="condition_type"/>
                        <field name="severity"/>
                        <field name="is_ongoing"/>
                        <field name="follow_up_date"/>
                        <field name="notes"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- =================== -->
    <!-- Vaccination Views -->
    <!-- =================== -->

    <record id="view_vaccination_list" model="ir.ui.view">
        <field name="name">hr.employee.vaccination.list</field>
        <field name="model">hr.employee.vaccination</field>
        <field name="arch" type="xml">
            <list string="Vaccination">
                <field name="employee_id"/>
                <field name="vaccine_name"/>
                <field name="date_administered"/>
                <field name="next_due_date"/>
                <field name="notes"/>
            </list>
        </field>
    </record>

    <record id="view_vaccination_form" model="ir.ui.view">
        <field name="name">hr.employee.vaccination.form</field>
        <field name="model">hr.employee.vaccination</field>
        <field name="arch" type="xml">
            <form string="Vaccination">
                <sheet>
                    <group>
                        <field name="employee_id"/>
                        <field name="vaccine_name"/>
                        <field name="date_administered"/>
                        <field name="next_due_date"/>
                        <field name="notes"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- =================== -->
    <!-- Health Checkup Views -->
    <!-- =================== -->

    <record id="view_health_checkup_list" model="ir.ui.view">
        <field name="name">hr.employee.health.checkup.list</field>
        <field name="model">hr.employee.health.checkup</field>
        <field name="arch" type="xml">
            <list string="Health Checkups">
                <field name="employee_id"/>
                <field name="checkup_date"/>
                <field name="doctor_name"/>
                <field name="overall_health"/>
                <field name="fitness_certificate"/>
                <field name="notes"/>
            </list>
        </field>
    </record>

    <record id="view_health_checkup_form" model="ir.ui.view">
        <field name="name">hr.employee.health.checkup.form</field>
        <field name="model">hr.employee.health.checkup</field>
        <field name="arch" type="xml">
            <form string="Health Checkup">
                <sheet>
                    <group>
                        <field name="employee_id"/>
                        <field name="checkup_date"/>
                        <field name="doctor_name"/>
                        <field name="blood_pressure_systolic"/>
                        <field name="blood_pressure_diastolic"/>
                        <field name="pulse_rate"/>
                        <field name="temperature"/>
                        <field name="respiratory_rate"/>
                        <field name="overall_health"/>
                        <field name="fitness_certificate"/>
                        <field name="notes"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- =================== -->
    <!-- Actions & Menu Items -->
    <!-- =================== -->

    <record id="action_medical_history" model="ir.actions.act_window">
        <field name="name">Medical History</field>
        <field name="res_model">hr.employee.medical.history</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_vaccination" model="ir.actions.act_window">
        <field name="name">Vaccination</field>
        <field name="res_model">hr.employee.vaccination</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_health_checkup" model="ir.actions.act_window">
        <field name="name">Health Checkup</field>
        <field name="res_model">hr.employee.health.checkup</field>
        <field name="view_mode">list,form</field>
    </record>

    <!-- =================== -->
    <!-- Employee Form Inheritance (Main Fix) -->
    <!-- =================== -->

    <record id="view_employee_health_management_form" model="ir.ui.view">
        <field name="name">hr.employee.health.management.form</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_form"/>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='hr_settings']" position="after">
                <page string="Health Management" name="health_management">
                    <group>
                        <group string="Basic Health Information">
                            <field name="blood_group"/>
                            <field name="height"/>
                            <field name="weight"/>
                            <field name="bmi" readonly="1"/>
                            <field name="fitness_status"/>
                        </group>
                        <group string="Emergency Information">
                            <field name="emergency_contact_name"/>
                            <field name="emergency_contact_relationship"/>
                            <field name="emergency_contact_phone"/>
                            <field name="emergency_contact_phone2"/>
                            <field name="emergency_blood_bank"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Medical Conditions">
                            <field name="allergies"/>
                            <field name="chronic_conditions"/>
                            <field name="current_medications"/>
                        </group>
                        <group string="Medical Insurance">
                            <field name="health_insurance_provider"/>
                            <field name="health_insurance_number"/>
                            <field name="health_insurance_type"/>
                            <field name="health_insurance_expiry"/>
                        </group>
                    </group>

                    <group>
                        <group string="Health Status">
                            <field name="disability_status"/>
                            <field name="disability_description"/>
                            <field name="covid_vaccination_status"/>
                        </group>
                        <group string="Occupational Health">
                            <field name="occupational_hazards"/>
                            <field name="ppe_required"/>
                            <field name="work_restrictions"/>
                        </group>
                    </group>

                    <group>
                        <group string="Health Checkup Information">
                            <field name="last_checkup_date" />
                            <field name="next_checkup_date" />
                        </group>
                        <group string="Medical Records Summary">
                            <label for="vaccination_ids"/>
                            <div>
                                <field name="vaccination_ids" widget="many2many_tags" options="{'no_create': True}"/>
                                <button name="action_add_vaccination" type="object" string="Manage Vaccinations" class="btn-link"/>
                            </div>
                            <label for="medical_history_ids"/>
                            <div>
                                <field name="medical_history_ids" widget="many2many_tags" options="{'no_create': True}"/>
                                <button name="action_add_medical_history" type="object" string="Manage Medical History" class="btn-link"/>
                            </div>
                        </group>
                    </group>

                    <group string="Medical Documents">
                        <field name="medical_document_ids" widget="many2many_binary" nolabel="1"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
